"Статус бонуса агента"
type BonusStatus {
    id: ID!
    code: String!
    name: String!
    description: String
}

"Статус оплаты партнёром"
type PartnerPaymentStatus {
    id: ID!
    code: String!
    name: String!
    description: String
}

"Бонус (единая модель для агентов, кураторов и рефереров)"
type AgentBonus {
    id: ID!
    "ID пользователя-получателя бонуса"
    user_id: ID!
    "Пользователь-получатель бонуса"
    user: User @belongsTo
    "ID агента (alias для user_id, backward compatibility)"
    agent_id: ID! @rename(attribute: "user_id")
    "Агент (alias для user, backward compatibility)"
    agent: User @belongsTo(relation: "user")
    contract_id: ID
    contract: Contract @belongsTo
    order_id: ID
    order: Order @belongsTo
    commission_amount: Float!
    "Процент бонуса"
    percentage: Float
    status_id: ID!
    status: BonusStatus @belongsTo
    accrued_at: DateTime!
    available_at: DateTime
    paid_at: DateTime
    created_at: DateTime!
    updated_at: DateTime!
    "Тип получателя: agent, curator, referrer"
    recipient_type: String!
    "Человекочитаемый тип получателя"
    recipient_type_label: String! @method(name: "getRecipientTypeLabelAttribute")
    "Тип бонуса: agent или referral (legacy)"
    bonus_type: String
    "ID реферала, за сделку которого начислен бонус (только для referral)"
    referral_user_id: ID
    "Реферал, за сделку которого начислен бонус"
    referralUser: User @belongsTo
    "Тип источника: contract или order"
    source_type: String! @method(name: "getSourceTypeAttribute")
    "Сумма источника (договора или закупки)"
    source_amount: Float! @method(name: "getSourceAmountAttribute")
    "Название проекта"
    project_name: String @method(name: "getProjectNameAttribute")
    "Номер договора"
    contract_number: String @method(name: "getContractNumberAttribute")
    "Номер заказа"
    order_number: String @method(name: "getOrderNumberAttribute")
    "Выполнен ли договор (статус = completed). Для заказов = null"
    is_contract_completed: Boolean @method(name: "getIsContractCompletedAttribute")
    "Оплачен ли договор партнёром (partner_payment_status = paid). Для заказов = null"
    is_partner_paid: Boolean @method(name: "getIsPartnerPaidAttribute")
    "Человекочитаемый тип бонуса"
    bonus_type_label: String @method(name: "getBonusTypeLabelAttribute")
}

"Alias для AgentBonus (для совместимости)"
type Bonus {
    id: ID!
    user_id: ID!
    user: User @belongsTo
    contract_id: ID
    contract: Contract @belongsTo
    order_id: ID
    order: Order @belongsTo
    commission_amount: Float!
    percentage: Float
    status_id: ID!
    status: BonusStatus @belongsTo
    accrued_at: DateTime!
    available_at: DateTime
    paid_at: DateTime
    created_at: DateTime!
    updated_at: DateTime!
    recipient_type: String!
    recipient_type_label: String! @method(name: "getRecipientTypeLabelAttribute")
    bonus_type: String
    referral_user_id: ID
    referralUser: User @belongsTo
    source_type: String! @method(name: "getSourceTypeAttribute")
    source_amount: Float! @method(name: "getSourceAmountAttribute")
    project_name: String @method(name: "getProjectNameAttribute")
    contract_number: String @method(name: "getContractNumberAttribute")
    order_number: String @method(name: "getOrderNumberAttribute")
    is_contract_completed: Boolean @method(name: "getIsContractCompletedAttribute")
    is_partner_paid: Boolean @method(name: "getIsPartnerPaidAttribute")
    bonus_type_label: String @method(name: "getBonusTypeLabelAttribute")
}

"Статистика бонусов агента"
type AgentBonusStats {
    "Ожидание выплаты (начислено, но не доступно)"
    total_pending: Float!
    "Доступно к выплате (за вычетом запрошенных)"
    total_available: Float!
    "Запрошено к выплате"
    total_requested: Float!
    "Выплачено"
    total_paid: Float!
}

"Статистика бонусов для админки"
type AdminBonusStats {
    "Ожидание выплаты"
    total_pending: Float!
    "Доступно к выплате"
    total_available: Float!
    "Выплачено"
    total_paid: Float!
    "Количество бонусов по договорам"
    contracts_count: Int!
    "Количество бонусов по заказам"
    orders_count: Int!
    "Общая сумма реферальных бонусов"
    total_referral: Float!
    "Количество реферальных бонусов"
    referral_count: Int!
    "Общая сумма агентских бонусов"
    total_agent: Float!
    "Количество агентских бонусов"
    agent_count: Int!
    "Общая сумма кураторских бонусов"
    total_curator: Float!
    "Количество кураторских бонусов"
    curator_count: Int!
}

"Фильтры для бонусов агента"
input AgentBonusFilters {
    "Код статуса (pending, paid)"
    status_code: String
    "Тип источника (contract, order)"
    source_type: String
    "Тип получателя (agent, curator, referrer)"
    recipient_type: String
    "Тип бонуса (agent, referral) - legacy"
    bonus_type: String
    "Дата начисления от"
    date_from: DateTime
    "Дата начисления до"
    date_to: DateTime
    "ID агента/пользователя (для админки)"
    agent_id: ID
    "ID пользователя (alias для agent_id)"
    user_id: ID
}

"Статистика реферальных бонусов"
type ReferralBonusStats {
    "Ожидание выплаты"
    total_pending: Float!
    "Доступно к выплате"
    total_available: Float!
    "Выплачено"
    total_paid: Float!
    "Общая сумма"
    total: Float!
    "Список рефералов с их статистикой"
    referrals: [ReferralUserStats!]!
}

"Статистика по рефералу"
type ReferralUserStats {
    "ID реферала"
    user_id: ID!
    "Имя реферала"
    name: String!
    "Email реферала"
    email: String!
    "Дата регистрации"
    registered_at: DateTime!
    "Активна ли реферальная программа"
    is_active: Boolean!
    "Общая сумма бонусов от этого реферала"
    total_bonus: Float!
}


extend type Query {
    "Получить бонусы текущего агента"
    agentBonuses(filters: AgentBonusFilters): [AgentBonus!]!
        @field(resolver: "App\\GraphQL\\Queries\\AgentBonusesQuery")

    "Получить статистику бонусов текущего агента"
    agentBonusStats(filters: AgentBonusFilters): AgentBonusStats!
        @field(resolver: "App\\GraphQL\\Queries\\AgentBonusStatsQuery")

    "Получить статистику реферальных бонусов текущего агента"
    referralBonusStats: ReferralBonusStats!
        @field(resolver: "App\\GraphQL\\Queries\\ReferralBonusStatsQuery")

    "Получить доступные к выплате бонусы агента (для админа)"
    availableBonusesForPayment(agent_id: ID!): [AgentBonus!]!
        @field(resolver: "App\\GraphQL\\Queries\\AvailableBonusesQuery")

    "Справочник статусов бонусов"
    bonusStatuses: [BonusStatus!]! @all(model: "App\\Models\\BonusStatus")

    "Справочник статусов оплаты партнёром"
    partnerPaymentStatuses: [PartnerPaymentStatus!]! @all(model: "App\\Models\\PartnerPaymentStatus")

    "Получить все бонусы для админки"
    adminBonuses(filters: AgentBonusFilters): [AgentBonus!]!
        @field(resolver: "App\\GraphQL\\Queries\\AdminBonusesQuery")

    "Получить статистику бонусов для админки"
    adminBonusStats(filters: AgentBonusFilters): AdminBonusStats!
        @field(resolver: "App\\GraphQL\\Queries\\AdminBonusStatsQuery")
}

extend type Mutation {
    "Обновить статус оплаты партнёром для договора"
    updateContractPartnerPaymentStatus(contract_id: ID!, status_code: String!): Contract!
        @field(resolver: "App\\GraphQL\\Mutations\\UpdateContractPartnerPaymentStatus")

    "Обновить статус оплаты партнёром для закупки"
    updateOrderPartnerPaymentStatus(order_id: ID!, status_code: String!): Order!
        @field(resolver: "App\\GraphQL\\Mutations\\UpdateOrderPartnerPaymentStatus")

    "Обновить статус бонуса"
    updateBonusStatus(bonus_id: ID!, status_code: String!): AgentBonus!
        @field(resolver: "App\\GraphQL\\Mutations\\UpdateBonusStatus")
}
