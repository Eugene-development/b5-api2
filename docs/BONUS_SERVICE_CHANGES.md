# Изменения в BonusService

## Дата: 27.12.2025

## Упрощение логики статусов бонусов

С переходом на два статуса бонусов (`pending` и `paid`) следующие методы в `BonusService` стали устаревшими:

### Устаревшие методы:

1. **`markBonusAsAvailable()`** - больше не используется
2. **`revertBonusToAccrued()`** - больше не используется
3. **`handleContractPartnerPaymentStatusChange()`** - статус оплаты партнёром больше не влияет на статус бонуса
4. **`handleOrderPartnerPaymentStatusChange()`** - статус оплаты партнёром больше не влияет на статус бонуса
5. **`handleContractStatusChange()`** - статус договора больше не влияет на статус бонуса
6. **`handleContractActiveChange()`** - is_active больше не влияет на статус бонуса
7. **`handleOrderStatusChange()`** - статус заказа больше не влияет на статус бонуса
8. **`handleOrderActiveChange()`** - is_active больше не влияет на статус бонуса

### Новая логика:

- Бонус создаётся сразу в статусе **`pending`** (Ожидание)
- Бонус переходит в статус **`paid`** (Выплачено) только при создании выплаты агенту
- Промежуточный статус "Доступно к выплате" удалён
- Статусы договоров/заказов и оплата партнёром больше не влияют на статус бонуса

### Обновлённые методы:

- `createBonusForContract()` - создаёт бонус со статусом `pending`
- `createBonusForOrder()` - создаёт бонус со статусом `pending`
- `getAgentStats()` - возвращает только `total_pending` и `total_paid`

### Рекомендации:

Устаревшие методы оставлены для обратной совместимости, но не выполняют никаких действий. Их можно безопасно удалить после проверки, что они нигде не вызываются.
